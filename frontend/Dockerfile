# ğŸ‘‰ 1ë‹¨ê³„: ë¹Œë“œ ìŠ¤í…Œì´ì§€
FROM node:18-alpine AS builder

WORKDIR /app

# VITEìš© í™˜ê²½ë³€ìˆ˜ ì „ë‹¬ì„ ìœ„í•œ ARG ì„ ì–¸
ARG VITE_API_BASE_URL
ENV VITE_API_BASE_URL=$VITE_API_BASE_URL

# package.jsonê³¼ package-lock.json ë³µì‚¬
COPY package*.json ./

# ì˜ì¡´ì„± ì„¤ì¹˜
RUN npm ci

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬
COPY . .

# ë¹Œë“œ ì‹¤í–‰ (ViteëŠ” í™˜ê²½ë³€ìˆ˜ ì‚¬ìš© ì‹œ ë°˜ë“œì‹œ VITE_ ì ‘ë‘ì‚¬ í•„ìš”)
RUN npm run build

# ğŸ‘‰ 2ë‹¨ê³„: í”„ë¡œë•ì…˜ ìŠ¤í…Œì´ì§€
FROM nginx:alpine

# nginx ì„¤ì • íŒŒì¼ ë³µì‚¬
COPY nginx.conf /etc/nginx/nginx.conf

# ë¹Œë“œëœ ì •ì  íŒŒì¼ì„ nginxë¡œ ë³µì‚¬
COPY --from=builder /app/dist /usr/share/nginx/html

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 80

# nginx ì‹¤í–‰
CMD ["nginx", "-g", "daemon off;"]